<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>channel Messaging multiMessage OTHER.</title>
    <link href="http://fonts.googleapis.com/css?family=Open+Sans+Condensed:300|Lobster+Two" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="style.css" />
</head>

<body>
    <!-- 消息列表 -->
    <ul></ul>
    <script>
        // 获取ul元素
        const ul = document.querySelector("ul");
        // 定义 port2 变量来存储 MessagePort 对象。
        let port2;
        // 监听窗口的message事件，并处理接收到的消息
        window.addEventListener("message", (e) => {
            // 检查事件对象是否包含 MessagePort 对象
            if (e.ports[0]) {
                // MessagePort 对象存在时，将其赋值给 port2 变量。
                port2 = e.ports[0];
                // 为 port2 绑定 message 事件处理函数，用于处理从主线程接收的消息。
                port2.onmessage = (e) => {
                    // 创建一个新的列表项元素，并设置其文本内容为接收到的消息。
                    const li = document.createElement("li");
                    // 创建一个新的span元素，用于显示消息内容。
                    const messageText = document.createElement("span");
                    // 设置span元素的文本内容为接收到的消息。如果数据类型是对象，则将其转换为字符串形式显示；否则直接显示原始值。
                    messageText.textContent = typeof e.data === "object" ? JSON.stringify(e.data) : e.data;
                    // 创建一个新的span元素，用于显示消息的时间戳。
                    const timestamp = document.createElement("span");
                    // 添加timestamp类名，用于样式化时间戳元素。
                    timestamp.classList.add("timestamp");
                    // 设置时间戳元素的文本内容为当前时间的本地化表示。
                    timestamp.textContent = new Date().toLocaleTimeString();
                    // 设置时间戳元素的左外边距为1em，用于与消息内容分隔开。
                    timestamp.style.marginLeft = "1em";
                    // 将时间戳元素和消息内容元素添加到列表项中。
                    li.appendChild(messageText);
                    // 将时间戳元素添加到列表项中。
                    li.appendChild(timestamp);
                    // 将列表项添加到ul元素的开头，实现新消息的顶部显示。
                    ul.prepend(li);
                };
            }
        });
    </script>
</body>

</html>